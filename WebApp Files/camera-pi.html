<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Team Greenhouse</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="all,follow">
    <!-- Bootstrap CSS-->
    <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet"/>
    <!-- Google fonts - Roboto -->
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:300,400,500,700">
    <!-- theme stylesheet-->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.default.css') }}" id="theme-stylesheet">
    <!-- jQuery Circle-->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/grasp_mobile_progress_circle-1.0.0.min.css') }}">
    <!-- Custom stylesheet - for your changes-->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/custom.css') }}">
    <!-- Favicon-->
    <link rel="shortcut icon" href="img/favicon.ico">
    <!-- Font Awesome CDN-->
    <!-- you can replace it by local Font Awesome-->
    <script src="https://use.fontawesome.com/99347ac47f.js"></script>
    <!-- Font Icons CSS-->
    <link rel="stylesheet" href="https://file.myfontastic.com/da58YPMQ7U5HY8Rb6UxkNf/icons.css">
    <!-- Tweaks for older IEs--><!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]-->
        <link rel="stylesheet" href="{{ url_for('static', filename='css/site.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/toastr.min.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/slick.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='cssslick-theme.css') }}">
  </head>
  <body>
    <!-- Side Navbar -->
    <nav class="side-navbar">
      <div class="side-navbar-wrapper">
        <div class="sidenav-header d-flex align-items-center justify-content-center">
          <div class="sidenav-header-inner text-center"><img src="img/avatar-1.jpg" alt="person" class="img-fluid rounded-circle">
            <h2 class="h5 text-uppercase">IoT Greenhouse</h2><span class="text-uppercase">Administrator</span>
          </div>
          <div class="sidenav-header-logo"><a href="index.html" class="brand-small text-center"> <strong>B</strong><strong class="text-primary">D</strong></a></div>
        </div>
        <div class="main-menu">
          <ul id="side-main-menu" class="side-menu list-unstyled">                  
            <li><a href="index.html"> <i class="icon-home"></i><span>Home</span></a></li>
            <li> <a href="settings.html"><i class="icon-form"></i><span>Greenhouse Settings</span></a></li>
            <li class="active"> <a href="camera.html"><i class="icon-presentation"></i><span>Live Cam & Photos</span></a></li>

          </ul>
        </div>

      </div>
    </nav>
    <div class="page home-page">
      <!-- navbar-->
      <header class="header">
        <nav class="navbar">
          <div class="container-fluid">
            <div class="navbar-holder d-flex align-items-center justify-content-between">
              <div class="navbar-header"><a id="toggle-btn" href="#" class="menu-btn"><i class="icon-bars"> </i></a><a href="index.html" class="navbar-brand">
                  <div class="brand-text hidden-sm-down"><strong class="text-primary">MY GREENHOUSE</strong></div></a></div>

            </div>
          </div>
        </nav>
      </header>
      <div class="breadcrumb-holder">   
        <div class="container-fluid">
          <ul class="breadcrumb">
            <li class="breadcrumb-item"><a href="index.html">Home</a></li>
            <li class="breadcrumb-item active">Live Cam & Photos</li>
          </ul>
        </div>
      </div>
      <section class="charts">
        <div class="container-fluid">
          <header> 
            <h1 class="h3">Live Camera Feed</h1>
            <span>View a live feed of your Greenhouse as it happens.</span>
          </header>
          <div class="row">
            <div class="col-xl-12 col-md-12">
            <div id="cameraFeed">
              <img style='height: 100%; width: 100%; object-fit: fill' src="{{ url_for('video_feed') }}">
          </div>
        </div>


          </div>
        </div>

        <div class="container-fluid">
            <header> 
              <h1 class="h3">Captured Images</h1>
              <span>View a gallery of all the photos you have taken of your beautiful plant!</span>
            </header>
            <div class="row">
              <div class="col-xl-12 col-md-12">
                <div id="gallery" class="col-md-12">

                </div>
          </div>
  
  
            </div>
          </div>
      </section>
      <footer class="main-footer">
        <div class="container-fluid">
          <div class="row">
            <div class="col-sm-6">
              <p>IoT Greenhouse</p>
            </div>
            <div class="col-sm-6 text-right">
              <p>Design by <a href="https://bootstrapious.com" class="external">Bootstrapious</a></p>
              <!-- Please do not remove the backlink to us unless you support further theme's development at https://bootstrapious.com/donate. It is part of the license conditions. Thank you for understanding :)-->
            </div>
          </div>
        </div>
      </footer>
    </div>
    <!-- Javascript files-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="{{ url_for('static', filename='js/tether.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.cookie.js') }}"> </script>
    <script src="{{ url_for('static', filename='js/grasp_mobile_progress_circle-1.0.0.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.nicescroll.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.validate.min.js') }}"></script>
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>-->
    <script src="{{ url_for('static', filename='js/charts-home.js') }}"></script>
    <script src="{{ url_for('static', filename='js/front.js') }}"></script>
    <script src="{{ url_for('static', filename='js/raphael-2.1.4.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/justgage.js') }}"></script>
    <script src="{{ url_for('static', filename='js/vue.js') }}"></script>
    <script src="https://www.gstatic.com/firebasejs/4.2.0/firebase.js"></script>
    <script src="{{ url_for('static', filename='js/toastr.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/moment.js') }}"></script>
    <script src="{{ url_for('static', filename='js/slick.min.js') }}"></script>
    <!-- Google Analytics: change UA-XXXXX-X to be your site's ID.-->
    <!---->
    <script>
    // Global Variables
    var ImageURLArr = new Array();
    var nameCounter = 0;

    var config = {
            apiKey: "AIzaSyAlX8g6Ot35en0SAlY5LPP3DdMFD8ObG50",
            authDomain: "iotca2-7591e.firebaseapp.com",
            databaseURL: "https://iotca2-7591e.firebaseio.com",
            //projectId: "iotca2-7591e",
            storageBucket: "iotca2-7591e.appspot.com",
            //messagingSenderId: "761493129911"
        };
        firebase.initializeApp(config);

    
    var database = firebase.database();

    var ImageFrame = "<ul class='gall columns'><li v-for='(image, index) in imagesObjectsArr'>"
                    + "<img height='200' width='300' v-bind:src='image.ImgSrc' />"
                    + "<h3 v-text='image.ImgName'></h3>"
                    + "<div><h5><strong>Date and Time of capture: </strong></h5><h5 v-text='image.CapturedAt'></h5></div>"
                    + "</li></ul>";

    var vueImageHistory = new Vue({
      el: '#gallery',
      template: ImageFrame,
      data: {
        imagesObjectsArr: []
      },
      created: function(){

        var PhotosFromFirebase = firebase.database().ref('captured_images');
        PhotosFromFirebase.on('child_added', function(snapshot) {
            nameCounter++
            var retrievedMessage = snapshot.val();
            var obj = new Object();
            obj.ImgName = "ImageFromPi";
            obj.CapturedAt = moment.unix(snapshot.val().date).format("DD MMM YYYY [at] hh:mm A");
            obj.ImgSrc = snapshot.val().image_url;
            console.log(retrievedMessage)
            snapshot.forEach(function(child){
              console.log(child.key+': '+child.val().image_url);

              //soilTimeDataForLiveChart.push(moment.unix(child.val().timestamp).format("D MMM YY h:mm:ssa"))

            });
            vueImageHistory.imagesObjectsArr.unshift(obj);
        });

         var converted = moment.unix(this.timeStamp).format("DD MMM YYYY [at] hh:mm A");
         var timeReport = "Last updated on " + converted;
         this.timeStr = timeReport;
      }

    })


    </script>
  </body>
</html>