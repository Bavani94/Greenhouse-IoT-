<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Team Greenhouse</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="all,follow">
    <!-- Bootstrap CSS-->
    <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet"/>
    <!-- Google fonts - Roboto -->
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:300,400,500,700">
    <!-- theme stylesheet-->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.default.css') }}" id="theme-stylesheet">
    <!-- jQuery Circle-->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/grasp_mobile_progress_circle-1.0.0.min.css') }}">
    <!-- Custom stylesheet - for your changes-->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/custom.css') }}">
    <!-- Favicon-->
    <link rel="shortcut icon" href="img/favicon.ico">
    <!-- Font Awesome CDN-->
    <!-- you can replace it by local Font Awesome-->
    <script src="https://use.fontawesome.com/99347ac47f.js"></script>
    <!-- Font Icons CSS-->
    <link rel="stylesheet" href="https://file.myfontastic.com/da58YPMQ7U5HY8Rb6UxkNf/icons.css">
    <!-- Tweaks for older IEs--><!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]-->
        <link rel="stylesheet" href="{{ url_for('static', filename='css/site.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/toastr.min.css') }}">
  </head>
  <body>
    <!-- Side Navbar -->
    <nav class="side-navbar">
      <div class="side-navbar-wrapper">
        <div class="sidenav-header d-flex align-items-center justify-content-center">
          <div class="sidenav-header-inner text-center"><img src="img/avatar-1.jpg" alt="person" class="img-fluid rounded-circle">
            <h2 class="h5 text-uppercase">IoT Greenhouse</h2><span class="text-uppercase">Administrator</span>
          </div>
          <div class="sidenav-header-logo"><a href="index.html" class="brand-small text-center"> <strong>G</strong><strong class="text-primary">H</strong></a></div>
        </div>
        <div class="main-menu">
          <ul id="side-main-menu" class="side-menu list-unstyled">                  
            <li><a href="index.html"> <i class="icon-home"></i><span>Home</span></a></li>
            <li class="active"> <a href="settings.html"><i class="icon-form"></i><span>Greenhouse Settings</span></a></li>
            <li> <a href="camera.html"><i class="icon-presentation"></i><span>Live Cam & Photos</span></a></li>
          </ul>
        </div>
        
      </div>
    </nav>
    <div class="page forms-page">
      <!-- navbar-->
      <header class="header">
        <nav class="navbar">
          <div class="container-fluid">
            <div class="navbar-holder d-flex align-items-center justify-content-between">
              <div class="navbar-header"><a id="toggle-btn" href="#" class="menu-btn"><i class="icon-bars"> </i></a><a href="index.html" class="navbar-brand">
                  <div class="brand-text hidden-sm-down"><strong class="text-primary">MY GREENHOUSE</strong></div></a></div>

            </div>
          </div>
        </nav>
      </header>
      <div class="breadcrumb-holder">
        <div class="container-fluid">
          <ul class="breadcrumb">
            <li class="breadcrumb-item"><a href="index.html">Home</a></li>
            <li class="breadcrumb-item active">Greenhouse Settings</li>
          </ul>
        </div>
      </div>
      <section class="forms">
        <div class="container-fluid">
          <header> 
            <h1 class="h3 display">Greenhouse Settings</h1>
            <span>Fine tune and tweak your Greenhouse configurations here</span>
          </header>
          <div class="row">
            <div class="col-lg-12">
              <div class="card">
                <div class="card-header d-flex align-items-center">
                  <h2 class="h5 display display">My Greenhouse Settings</h2>
                </div>
                <div class="card-block">
                    <p>Greenhouse Autopilot Conditions and Thresholds</p>
                    <div id="VueAutoPilot">

                    </div>
                </div>
              </div>
            </div>




          </div>
        </div>
      </section>
      <footer class="main-footer">
        <div class="container-fluid">
          <div class="row">
            <div class="col-sm-6">
              <p>IoT Greenhouse</p>
            </div>
            <div class="col-sm-6 text-right">
              <p>Design by <a href="https://bootstrapious.com" class="external">Bootstrapious</a></p>
              <!-- Please do not remove the backlink to us unless you support further theme's development at https://bootstrapious.com/donate. It is part of the license conditions. Thank you for understanding :)-->
            </div>
          </div>
        </div>
      </footer>
    </div>
    <!-- Javascript files-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="{{ url_for('static', filename='js/tether.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.cookie.js') }}"> </script>
    <script src="{{ url_for('static', filename='js/grasp_mobile_progress_circle-1.0.0.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.nicescroll.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.validate.min.js') }}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
    <script src="{{ url_for('static', filename='js/charts-home.js') }}"></script>
    <script src="{{ url_for('static', filename='js/front.js') }}"></script>
    <script src="{{ url_for('static', filename='js/raphael-2.1.4.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/justgage.js') }}"></script>
    <script src="{{ url_for('static', filename='js/vue.js') }}"></script>
    <script src="https://www.gstatic.com/firebasejs/4.2.0/firebase.js"></script>
    <script src="{{ url_for('static', filename='js/toastr.min.js') }}"></script>
    <!-- Google Analytics: change UA-XXXXX-X to be your site's ID.-->
    <!---->
    <script>
        function saveChangesPubMQTT(){
 		$.ajax({url: "saveConfig",
 			success: function(result){
 			var a = result;
 			}
 		})
 	}
      // Initialize Firebase
      var config = {
            apiKey: "AIzaSyAlX8g6Ot35en0SAlY5LPP3DdMFD8ObG50",
            authDomain: "iotca2-7591e.firebaseapp.com",
            databaseURL: "https://iotca2-7591e.firebaseio.com",
            //projectId: "iotca2-7591e",
            storageBucket: "iotca2-7591e.appspot.com",
            //messagingSenderId: "761493129911"
        };
        firebase.initializeApp(config);

        var database = firebase.database();





      var AutopilotTemplate = "<div>"
                  + "<form>"
                  + "<div class='form-group col-md-3'>"
                  + "<label>Soil Moisture Threshold</label>"
                  + "<div class='input-group'>"
                  + "<input type='number' min='0' max='100' v-model='SoilMoistureLimitVal' placeholder='30' class='form-control' aria-describedby='moisture-percent'>"
                  + "<span class='input-group-addon' id='moisture-percent'>%</span>"
                  + "</div><small class='form-text' v-text='IntToStrSoil()'></small>"
                  + "</div>"
                  + "<div class='form-group col-md-3'>"       
                  + "<label>Light Value Threshold</label>"
                  + "<input type='number' min='0' max='1024' placeholder='400' v-model='LightLimitVal' class='form-control'><small class='form-text' v-text='IntToStrLight()'></small>"
                  + "</div>"
                  + "<div class='form-group col-md-3'>"
                  + "<label>Watering Duration</label>"
                  + "<div class='input-group'>"
                  + "<input type='number' min='1' v-model='PumpTimeDuration' class='form-control' placeholder='5' aria-describedby='pump-timing'>"
                  + "<span class='input-group-addon' id='pump-timing'>Seconds</span>"
                  + "</div><small class='form-text' v-text='IntToStrPump()'></small></div>"
                  + "<div class='form-group col-md-3'>"
                  + "<label>Humidity Threshold</label>"
                  + "<div class='input-group'>"
                  + "<input type='number' min='0' max='100' v-model='HumLimitVal' class='form-control' placeholder='5' aria-describedby='hum-limit'>"
                  + "<span class='input-group-addon' id='hum-limit'>Seconds</span>"
                  + "</div><small class='form-text' v-text='IntToStrFan()'></small></div>"
                  + ""
                  + ""
                  + "<div class='form-group'>"
                  + "<input type='button' value='Save Changes' v-on:click='saveChanges()' class='btn btn-primary'>"
                  + "</div>"
                  + "</form></div>"



      var AutopilotSettings = new Vue ({
          el: '#VueAutoPilot',
          template: AutopilotTemplate,
          data: {
          SoilMoistureLimitVal: 0,
          LightLimitVal: 0,
          PumpTimeDuration: 0,
          HumLimitVal: 0
      },
      computed: {
          // a computed getter
          
        },
        methods: {
          saveChanges: function(){
            database.ref("led_status").update({ threshold: parseInt(this.LightLimitVal) });
            database.ref("pump_status").update({ duration: parseInt(this.PumpTimeDuration) });
            database.ref("pump_status").update({ threshold: parseInt(this.SoilMoistureLimitVal) });//Not a typo
            database.ref("fan_status").update({ threshold: parseInt(this.HumLimitVal) });

            $.ajax({url: "saveConfig",
              success: function(result){
              var a = result;
              }
            })


            toastr.options = {
              "closeButton": false,
              "debug": false,
              "newestOnTop": false,
              "progressBar": false,
              "positionClass": "toast-bottom-right",
              "preventDuplicates": false,
              "onclick": null,
              "showDuration": "300",
              "hideDuration": "1000",
              "timeOut": "5000",
              "extendedTimeOut": "1000",
              "showEasing": "swing",
              "hideEasing": "linear",
              "showMethod": "fadeIn",
              "hideMethod": "fadeOut"
            }

            toastr["success"]("Your settings have been updated!", "Saved!")
          },
          IntToStrSoil: function () {
            // `this` points to the vm instance
            var LimitValInStr = this.SoilMoistureLimitVal.toString()
            var fixed = 'When the soil moisture dips below ' + LimitValInStr + '% turn on water pump.'
            return fixed;
          },
          IntToStrLight: function () {
            // `this` points to the vm instance
            var LimitValInStr = this.LightLimitVal.toString()
            var fixed = 'When the light value exceeds ' + LimitValInStr + ' the LED light will be activated.'
            return fixed;
          },
          IntToStrPump: function () {
            // `this` points to the vm instance
            var LimitValInStr = this.PumpTimeDuration.toString()
            var fixed = 'Activate the water pump for ' + LimitValInStr + ' seconds before deactivating it again.'
            return fixed;
          },
          IntToStrFan: function () {
            // `this` points to the vm instance
            var LimitValInStr = this.HumLimitVal.toString()
            var fixed = 'Turn on the Fan when the Humidity level in the Greenhouse dips below ' + LimitValInStr + '%.'
            return fixed;
          }

        },
        created: function(){
              var ledThreshold = database.ref("led_status/threshold");
          ledThreshold.on('value', function(snapshot) {
                var retrievedMessage = snapshot.val();
                AutopilotSettings.LightLimitVal = retrievedMessage;
          });

          var HumThreshold = database.ref("fan_status/threshold");
          HumThreshold.on('value', function(snapshot) {
                var retrievedMessage = snapshot.val();
                AutopilotSettings.HumLimitVal = retrievedMessage;
          });

          var pumpStats = database.ref("pump_status/duration");
            pumpStats.on('value', function(snapshot) {
                var retrievedMessage = snapshot.val();
                AutopilotSettings.PumpTimeDuration = retrievedMessage;
          });

          var soilMoistureThreshold = database.ref("pump_status/threshold");//Not typo
          soilMoistureThreshold.on('value', function(snapshot) {
                var retrievedMessage = snapshot.val();
                AutopilotSettings.SoilMoistureLimitVal = retrievedMessage;
          });
        }



      })








    </script>
  </body>
</html>